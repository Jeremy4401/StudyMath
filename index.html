<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>SME Launcher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        @font-face {
            font-family: "Comic Sans MS";
            src: local("Comic Sans MS");
        }

        :root {
            --bg: #0f0f0f;
            --bg2: #1a1a1a;
            --text: #fff;
            --accent: #4caf50;
            --sidebar: #000;
            --banner1: #000;
            --banner2: #0f0f0f;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: "Comic Sans MS";
            overflow-x: hidden;
        }

        body.light {
            --bg: #f5f5f5;
            --bg2: #ffffff;
            --text: #111;
            --accent: #2196f3;
            --sidebar: #222;
        }

        /* SIDEBAR */
        #sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 75px;
            height: 100%;
            background: var(--sidebar);
            padding-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        #sidebar div {
            padding: 15px;
            cursor: pointer;
            text-align: center;
            font-size: 24px;
            transition: 0.2s;
        }

        #sidebar div:hover {
            transform: scale(1.2);
        }

        /* MAIN */
        #main {
            margin-left: 90px;
            padding: 20px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        #homeDashboard {
            padding: 20px;
            animation: fadeIn 0.4s ease;
        }

        .homeCard {
            background: var(--bg2);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 0 10px #0005;
        }

        .postBox {
            background: #222;
            padding: 12px;
            border-radius: 10px;
            margin: 10px 0;
        }

        body.light .postBox {
            background: #ddd;
        }

        .postAuthor {
            font-weight: bold;
            color: var(--accent);
        }

        .postTime {
            opacity: 0.6;
            font-size: 11px;
        }

        .postActions {
            margin-top: 5px;
            font-size: 13px;
            opacity: 0.8;
            display: flex;
            gap: 15px;
        }

        /* GAME CARDS */
        .card {
            background: var(--bg2);
            width: 260px;
            height: 380px;
            border-radius: 12px;
            padding: 12px;
            display: inline-flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            margin: 8px;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
            vertical-align: top;
        }

        .card:hover {
            transform: translateY(-6px) scale(1.05);
        }

        .card img {
            width: 100%;
            height: auto;
            max-height: 260px;
            /* keeps them from getting too tall */
            object-fit: contain;
            /* shows full PNG without cropping */
            border-radius: 10px;
            display: block;
        }

        .star {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 20px;
            cursor: pointer;
            color: #777;
        }

        .star.fav {
            color: gold;
            text-shadow: 0 0 10px gold;
        }

        #embedWin {
            display: none;
            position: fixed;
            inset: 0;
            background: #000d;
            z-index: 9999;
        }

        #embedFrame {
            width: 100%;
            height: 100%;
            border: none;
        }

        .profileBanner {
            width: 100%;
            height: 90px;
            background: linear-gradient(90deg, var(--accent), transparent);
            border-radius: 12px;
        }

        .profileAvatar {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            border: 3px solid var(--bg2);
            margin-top: -48px;
            margin-left: 15px;
            background: #333;
        }

        .tabBtn {
            padding: 8px 14px;
            border-radius: 8px;
            border: none;
            background: #222;
            color: var(--text);
            cursor: pointer;
        }

        .tabBtn:hover {
            background: var(--accent);
        }

        #settingsContent {
            background: var(--bg2);
            padding: 15px;
            border-radius: 10px;
        }

        .sme-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #333;
            color: #fff;
            padding: 10px 14px;
            border-radius: 8px;
            box-shadow: 0 0 10px #000;
            font-size: 14px;
            opacity: 0;
            transition: 0.25s;
            z-index: 10000;
        }

        .sme-toast.success {
            background: #2e7d32;
        }

        .sme-toast.info {
            background: #1976d2;
        }

        .sme-toast.error {
            background: #c62828;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #homeBtn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 55px;
            height: 55px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 26px;
            cursor: pointer;
            z-index: 5000;
            box-shadow: 0 0 10px #0008;
            transition: 0.2s;
        }

        #homeBtn:hover {
            transform: scale(1.15);
        }
    </style>
</head>

<body onload="renderHome()">
    <div id="sidebar">
        <div onclick="nav('homeDashboard')">üè†</div>
        <div onclick="nav('games')">üéÆ</div>
        <div onclick="nav('favorites')">‚≠ê</div>
        <div onclick="nav('theater')">üé¨</div>
        <div onclick="nav('friends')">üë•</div>
        <div onclick="nav('profile')">üë§</div>
        <div onclick="openSettings()">‚öôÔ∏è</div>
        <div onclick="toggleTheme()">üåó</div>
        <div onclick="panic()">‚ö†</div>
    </div>

    <div id="homeBtn" onclick="goHome()">üè†</div>

    <div id="main">
        <h1 id="pageTitle">Home</h1>

        <div id="homeDashboard" class="section active">
            <div class="homeCard">
                <h2>Welcome back!</h2>
                <p>To exit a game refresh the page or click esc</p>
            </div>

            <div id="continuePlaying" class="homeCard">
                <h3>Continue Playing</h3>
                <div id="continueList"></div>
            </div>

            <div id="socialFeed" class="homeCard">
                <h3>Social Feed</h3>
                <div id="feedPosts"></div>
                <textarea
                    id="feedInput"
                    placeholder="Share something..."
                    style="width:100%;height:60px;padding:10px;border:none;border-radius:8px;background:#222;color:white;margin-top:10px;"
                ></textarea>
                <button
                    onclick="postToFeed()"
                    style="padding:10px;margin-top:8px;width:100%;border:none;border-radius:8px;background:var(--accent);color:white;"
                >
                    Post
                </button>
            </div>

            <div id="friendsOnline" class="homeCard">
                <h3>Friends Online</h3>
                <div id="onlineList"></div>
            </div>

            <div id="activityLog" class="homeCard">
                <h3>Recent Activity</h3>
                <div id="activityList"></div>
            </div>
        </div>

        <div id="games" class="section">
            <h2>Games</h2>
            <div id="gameList"></div>
        </div>
        <div id="favorites" class="section">
            <h2>Favorites</h2>
            <div id="favoriteList"></div>
        </div>
        <div id="theater" class="section">
            <h2>Theater</h2>
            <p>Movies and media content would be loaded here.</p>
        </div>
        <div id="friends" class="section">
            <h2>Friends</h2>
            <p>Manage your friends and requests here.</p>
        </div>
        <div id="profile" class="section">
            <h2>Profile</h2>
            <div class="homeCard">
                <div class="profileBanner"></div>
                <img id="profileAvatarImg" class="profileAvatar" src="" alt="Avatar"/>
                <h3 id="profileUsername"></h3>
                <p id="profileBio"></p>
                <p>Status: <b id="profileStatus"></b></p>
                <p>Friend Code: <code id="profileCode"></code></p>
                <button onclick="openSettings()">Edit Profile</button>
            </div>
        </div>
        <div id="settingsPage" class="section">
            <h2>Settings</h2>
            <div id="settingsContent"></div>
        </div>
    </div>

    <div id="embedWin">
        <iframe id="embedFrame"></iframe>
    </div>

    <div
        id="gameModal"
        style="
            display: none;
            position: fixed;
            inset: 0;
            background: #000a;
            z-index: 9999;
            display: flex; /* Changed from inline style to be manageable in JS */
            align-items: center;
            justify-content: center;
        "
    >
        <div
            id="modalBox"
            style="
                width: 420px;
                background: var(--bg2);
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 0 20px #000;
                color: white;
            "
        >
            <img id="modalImg" src="" style="width: 100%; border-radius: 10px" />
            <h2 id="modalTitle"></h2>
            <p id="modalDesc"></p>
            <div id="playtimeBox" style="margin-top: 10px"></div>

            <button
                id="playBtn"
                style="
                    padding: 10px;
                    width: 100%;
                    border: none;
                    border-radius: 8px;
                    background: var(--accent);
                    color: white;
                    margin-top: 10px;
                "
            >
                Play
            </button>

            <button
                onclick="closeGameModal()"
                style="
                    padding: 10px;
                    width: 100%;
                    border: none;
                    border-radius: 8px;
                    background: #333;
                    color: white;
                    margin-top: 10px;
                "
            >
                Close
            </button>
        </div>
    </div>
    
    <script>
        /* ============================
            GLOBAL NAV + BASICS
        ============================ */

        function nav(id) {
            document.querySelectorAll(".section").forEach((s) =>
                s.classList.remove("active")
            );
            const target = document.getElementById(id);
            if (target) target.classList.add("active");

            const titleMap = {
                homeDashboard: "Home",
                games: "Games",
                favorites: "Favorites",
                theater: "Theater",
                friends: "Friends",
                profile: "Profile",
                settingsPage: "Settings",
            };

            document.getElementById("pageTitle").textContent =
                titleMap[id] || "SME";

            if (id === 'games') renderGames();
            if (id === 'favorites') renderFavorites();
            if (id === 'profile') renderProfile();
            if (id === 'settingsPage') openSettings();
            // if (id === "theater") loadTheater(); // loadTheater function is missing in the fragment
        }
        
        function goHome() {
            nav('homeDashboard');
        }

        function toggleTheme() {
            document.body.classList.toggle("light");
        }

        function panic() {
            location.href = "https://classroom.google.com";
        }

        function enc(u) {
            return u;
        }

        function notify(msg, type = "info") {
            const t = document.createElement("div");
            t.className = "sme-toast " + type;
            t.textContent = msg;
            document.body.appendChild(t);
            requestAnimationFrame(() => {
                t.style.opacity = 1;
            });
            setTimeout(() => {
                t.style.opacity = 0;
                setTimeout(() => t.remove(), 250);
            }, 2500);
        }

        /* ============================
            BASIC DATA LOAD
        ============================ */

        let recent = JSON.parse(localStorage.getItem("recent") || "[]");
        let activity = JSON.parse(localStorage.getItem("activity") || "[]");
        window.FRIENDS = []; // accepted friends (placeholder)
        window.REQUESTS = []; // incoming friend requests (placeholder)
        window.MESSAGES = {}; // DM chat histories (placeholder)

        let storedProfile = localStorage.getItem("profile");
        let profile = storedProfile
            ? JSON.parse(storedProfile)
            : {
                username: "SME User",
                bio: "Just playing some games.",
                status: "Online",
                avatar: "https://i.imgur.com/1X5Rz.png",
            };
            
        let friends = JSON.parse(localStorage.getItem("friends") || "[]");

        let friendCode = localStorage.getItem("friendCode");
        if (!friendCode) {
            friendCode =
                "SME-" +
                Math.random().toString(36).substring(2, 8).toUpperCase();
            localStorage.setItem("friendCode", friendCode);
        }

        function addRecent(name) {
            const idx = recent.indexOf(name);
            if (idx !== -1) recent.splice(idx, 1);
            recent.unshift(name);
            if (recent.length > 20) recent.pop();
            localStorage.setItem("recent", JSON.stringify(recent));
        }
        
        function addActivity(type, detail) {
            const entry = {
                type,
                detail,
                time: new Date().toLocaleTimeString(),
            };
            activity.unshift(entry);
            if (activity.length > 50) activity.pop();
            localStorage.setItem("activity", JSON.stringify(activity));
        }

        /* ============================
                HOME RENDER
        ============================ */

        function renderContinuePlaying() {
            const box = document.getElementById("continueList");
            if (!box) return;

            if (recent.length === 0) {
                box.innerHTML = "<p>No recent games.</p>";
                return;
            }

            box.innerHTML = "";
            recent.slice(0, 3).forEach((name) => {
                const g = games.find((x) => x.name === name);
                if (!g) return;
                box.innerHTML += `
                    <div class="card" style="width:150px; height: 200px;" onclick="showGameModal('${g.name}')">
                        <img src="${g.img}" alt="${g.name}">
                        <div style="font-size:14px;text-align:center;">${g.name}</div>
                    </div>
                `;
            });
        }

        let feed = JSON.parse(localStorage.getItem("feed") || "[]");

        function postToFeed() {
            const input = document.getElementById("feedInput");
            if (!input) return;
            const text = input.value.trim();
            if (!text) return;

            const entry = {
                id: Date.now(),
                user: profile.username || "You",
                text,
                time: new Date().toLocaleTimeString(),
                likes: 0,
                comments: [],
            };

            feed.unshift(entry);
            localStorage.setItem("feed", JSON.stringify(feed));
            input.value = "";
            renderFeed();
            notify("Posted to feed!", "success");
        }

        function likePost(id) {
            const p = feed.find((x) => x.id === id);
            if (!p) return;
            p.likes++;
            localStorage.setItem("feed", JSON.stringify(feed));
            renderFeed();
        }

        function commentPost(id) {
            const msg = prompt("Write a comment:");
            if (!msg) return;

            const p = feed.find((x) => x.id === id);
            if (!p) return;

            p.comments.push({
                user: profile.username || "You",
                text: msg,
                time: new Date().toLocaleTimeString(),
            });

            localStorage.setItem("feed", JSON.stringify(feed));
            renderFeed();
        }

        function renderFeed() {
            const box = document.getElementById("feedPosts");
            if (!box) return;

            box.innerHTML = "";
            if (feed.length === 0) {
                box.innerHTML = "<p>No posts yet. Be the first!</p>";
                return;
            }

            feed.forEach((p) => {
                let commentHTML = "";
                p.comments.forEach((c) => {
                    commentHTML += `
                        <div style="margin-left:10px;opacity:.8;">
                            <b style="color:var(--accent)">${c.user}:</b> ${c.text}
                            <span style="font-size:10px;opacity:.5;">${c.time}</span>
                        </div>
                    `;
                });

                box.innerHTML += `
                    <div class="postBox">
                        <div class="postAuthor">${p.user}</div>
                        <div class="postTime">${p.time}</div>
                        <p>${p.text}</p>
                        <div class="postActions">
                            <span onclick="likePost(${p.id})">‚ù§Ô∏è ${p.likes}</span>
                            <span onclick="commentPost(${p.id})">üí¨ Comment (${p.comments.length})</span>
                        </div>
                        ${commentHTML}
                    </div>
                `;
            });
        }

        function renderFriendsOnline() {
            const box = document.getElementById("onlineList");
            if (!box) return;

            box.innerHTML = "";
            if (friends.length === 0) {
                box.innerHTML = "<p>No friends added. Use the Friends section to add someone.</p>";
                return;
            }

            friends.forEach((code) => {
                box.innerHTML += `
                    <div style="padding:8px;background:#222;border-radius:8px;margin:5px 0;">
                        <b>${code}</b> ‚Äî <span style="color:#4caf50;">Online</span>
                    </div>
                `;
            });
        }

        function renderActivityHome() {
            const box = document.getElementById("activityList");
            if (!box) return;

            box.innerHTML = "";
            if (activity.length === 0) {
                box.innerHTML = "<p>No recent activity.</p>";
                return;
            }

            activity.slice(0, 5).forEach((a) => {
                box.innerHTML += `
                    <div style="padding:10px;background:#222;margin:8px 0;border-radius:10px;">
                        <b>${a.type}:</b> ${a.detail}<br>
                        <span style="font-size:10px;opacity:.6;">${a.time}</span>
                    </div>
                `;
            });
        }

        function renderHome() {
            renderContinuePlaying();
            renderFeed();
            renderFriendsOnline();
            renderActivityHome();
        }

        /* ============================
                        GAMES
        ============================ */

        let games = [
            { name: "Water (Password is funni)", img: "thumbnails/water.png", url: "https://cgxlyxnlynjpbmdiywnrc3RhcnRtewvkdwnhdglvbml0d2Fzc29zawdtv2.familyguy.in/signin.html", cat: "Action", desc: "A great unblocked version of an old favorite." },
            { name: "3D Tuning", img: "thumbnails/3dtuning.png", url: "https://www.3dtuning.com/en-US/", cat: "Action", desc: "Customize cars in 3D." },
            { name: "Slime Rancher", img: "thumbnails/slimerancher.png", url: "https://jeremy4401.github.io/SME/games/slimerancher.html", cat: "Action", desc: "Explore a world and farm slimes!" },
            { name: "Jacksmith", img: "thumbnails/jacksmith.png", url: "https://jeremy4401.github.io/jacksmith/", cat: "Action", desc: "Forge weapons for your heroes." },
            { name: "Mario Kart", img: "thumbnails/mariokart.png", url: "https://turbowarp.org/581185386/embed", cat: "Action", desc: "Race with Mario and friends." },
            { name: "Lego Star Wars Trilogy", img: "thumbnails/starwars.png", url: "https://realtherealer.github.io/GBA/launcher.html#lsw", cat: "Action", desc: "Experience the original trilogy in Lego form." },
            { name: "Minecraft", img: "thumbnails/minecraft.png", url: "https://jeremy4401.github.io/SME/games/minecraft.html", cat: "Survival", desc: "Explore, mine, build, and survive." },
            { name: "Buckshot Roulette", img: "thumbnails/buckshotroulette.png", url: "https://jeremy4401.github.io/SME/games/buckshotroulette.html", cat: "Horror", desc: "A deadly game of chance." },
            { name: "Schoolboy Runaway", img: "thumbnails/schoolboyrunaway.png", url: "https://jeremy4401.github.io/SME/games/schoolboyrunaway.html", cat: "Survival", desc: "Escape the school!" },
            { name: "Hollow Knight", img: "thumbnails/hollowknight.png", url: "https://jeremy4401.github.io/SME/games/hollowknight.html", cat: "Action", desc: "A beautiful 2D action-adventure." },
            { name: "10 Minutes Till Dawn", img: "thumbnails/10minutestilldawn.png", url: "https://jeremy4401.github.io/SME/games/10minutestilldawn.html", cat: "Action", desc: "Survive waves of enemies until dawn." },
            { name: "1v1.LOL", img: "thumbnails/1v1lol.png", url: "https://jeremy4401.github.io/SME/games/1v1lol.html", cat: "Action", desc: "Build and fight against others." },
            { name: "Amanda the Adventurer", img: "thumbnails/amandatheadventurer.png", url: "https://jeremy4401.github.io/SME/games/amandatheadventurer.html", cat: "Horror", desc: "A horror game disguised as a children's show." },
            { name: "Baseball Bros", img: "thumbnails/baseballbros.png", url: "https://Jeremy4401.github.io/SME/games/baseballbros.html", cat: "Sports", desc: "Hit home runs!" },
            { name: "Basket Bros", img: "thumbnails/basketbros.png", url: "https://Jeremy4401.github.io/SME/games/basketbros.html", cat: "Sports", desc: "Arcade basketball fun." },
            { name: "Football Bros", img: "thumbnails/footballbros.png", url: "https://Jeremy4401.github.io/SME/games/footballbros.html", cat: "Sports", desc: "Fast-paced football action." },
            { name: "Escape Road", img: "thumbnails/escaperoad.png", url: "https://Jeremy4401.github.io/SME/games/escaperoad.html", cat: "Racing", desc: "Drive to escape the chase." },
            { name: "Fallout", img: "thumbnails/fallout.png", url: "https://Jeremy4401.github.io/SME/games/fallout.html", cat: "RPG", desc: "Explore the post-apocalyptic wasteland." },
            { name: "Flappy Bird", img: "thumbnails/flappybird.png", url: "https://Jeremy4401.github.io/SME/games/flappybird.html", cat: "Arcade", desc: "The classic infuriating tapping game." },
            { name: "FNAF 1", img: "thumbnails/fnaf1.png", url: "https://Jeremy4401.github.io/SME/games/fnaf1.html", cat: "Horror", desc: "Survive five nights at Freddy Fazbear's Pizza." },
            { name: "FNAF 2", img: "thumbnails/fnaf2.png", url: "https://Jeremy4401.github.io/SME/games/fnaf2.html", cat: "Horror", desc: "The sequel with new animatronics." },
            { name: "FNAF 3", img: "thumbnails/fnaf3.png", url: "https://Jeremy4401.github.io/SME/games/fnaf3.html", cat: "Horror", desc: "30 years later, the horror returns." },
            { name: "FNAF 4", img: "thumbnails/fnaf4.png", url: "https://Jeremy4401.github.io/SME/games/fnaf4.html", cat: "Horror", desc: "The final chapter, played from a child's bedroom." },
            { name: "FNAF 4 Halloween Edition", img: "thumbnails/fnaf4halloween.png", url: "https://Jeremy4401.github.io/SME/games/fnaf4halloween.html", cat: "Horror", desc: "A spooky update to FNAF 4." },
            { name: "Sister Location", img: "thumbnails/sisterlocation.png", url: "https://Jeremy4401.github.io/SME/games/sisterlocation.html", cat: "Horror", desc: "Welcome to Circus Baby's Pizza World." },
            { name: "Freddy Fazbear's Pizzeria Simulator", img: "thumbnails/pizzeriasimulator.png", url: "https://Jeremy4401.github.io/SME/games/pizzeriasimulator.html", cat: "Horror", desc: "Build your own pizzeria... and survive." },
            { name: "Ultimate Custom Night", img: "thumbnails/ultimatecustomnight.png", url: "https://Jeremy4401.github.io/SME/games/ultimatecustomnight.html", cat: "Horror", desc: "The ultimate FNAF mashup challenge." },
            { name: "Endoparasitic", img: "thumbnails/endoparasitic.png", url: "https://Jeremy4401.github.io/SME/games/endoparasitic.html", cat: "Horror", desc: "Sci-fi horror with a nasty infection." },
            { name: "Drive Mad", img: "thumbnails/drivemad.png", url: "https://Jeremy4401.github.io/SME/games/drivemad.html", cat: "Racing", desc: "A challenging physics-based driving game." },
            { name: "Drift Hunters", img: "thumbnails/drifthunters.png", url: "https://Jeremy4401.github.io/SME/games/drifthunters.html", cat: "Racing", desc: "High-speed drifting simulator." },
            { name: "The Binding of Isaac", img: "thumbnails/bindingofisaac.png", url: "https://Jeremy4401.github.io/SME/games/bindingofisaac.html", cat: "Roguelike", desc: "A dark, action-packed dungeon crawler." },
            { name: "DOOM", img: "thumbnails/doom.png", url: "https://Jeremy4401.github.io/SME/games/doom.html", cat: "Shooter", desc: "The classic demon-slaying shooter." },
            { name: "DOOM 2", img: "thumbnails/doom2.png", url: "https://Jeremy4401.github.io/SME/games/doom2.html", cat: "Shooter", desc: "Hell on Earth." },
            { name: "Fruit Ninja", img: "thumbnails/fruitninja.png", url: "https://Jeremy4401.github.io/SME/games/fruitninja.html", cat: "Arcade", desc: "Slice and dice fruit." },
            { name: "Geometry Dash", img: "thumbnails/geometrydash.png", url: "https://Jeremy4401.github.io/SME/games/geometrydash.html", cat: "Rhythm", desc: "Rhythm-based platforming." },
            { name: "Getting Over It", img: "thumbnails/gettingoverit.png", url: "https://Jeremy4401.github.io/SME/games/gettingoverit.html", cat: "Challenging", desc: "The notorious game of falling down." },
            { name: "Granny", img: "thumbnails/granny1.png", url: "https://Jeremy4401.github.io/SME/games/granny1.html", cat: "Horror", desc: "Escape the terrifying house." },
            { name: "Granny Chapter 2", img: "thumbnails/granny2.png", url: "https://Jeremy4401.github.io/SME/games/granny2.html", cat: "Horror", desc: "Granny and Grandpa join the chase." },
            { name: "Granny Chapter 3", img: "thumbnails/granny3.png", url: "https://Jeremy4401.github.io/SME/games/granny3.html", cat: "Horror", desc: "A new location and more terror." },
            { name: "Controlled Flight", img: "thumbnails/controlledflight.png", url: "https://howthingsfly.si.edu/sites/default/files/unity/ControlledFlight_new/index.html", cat: "Simulation", desc: "Learn to fly a plane." },
            { name: "Jetpack Joyride", img: "thumbnails/jetpackjoyride.png", url: "https://Jeremy4401.github.io/SME/games/jetpackjoyride.html", cat: "Arcade", desc: "Blast off with a machine gun jetpack!" },
            { name: "Johnny Trigger", img: "thumbnails/johnnytrigger.png", url: "https://Jeremy4401.github.io/SME/games/johnnytrigger.html", cat: "Shooter", desc: "Slow-motion bullet-dodging fun." },
            { name: "Kindergarten", img: "thumbnails/kindergarten.png", url: "https://Jeremy4401.github.io/SME/games/kindergarten.html", cat: "Adventure", desc: "Survive a weird day at Kindergarten." },
            { name: "Kindergarten 2", img: "thumbnails/kindergarten2.png", url: "https://Jeremy4401.github.io/SME/games/kindergarten2.html", cat: "Adventure", desc: "The sequel to the bizarre school adventure." },
            { name: "Kindergarten 3", img: "thumbnails/kindergarten3.png", url: "https://Jeremy4401.github.io/SME/games/kindergarten3.html", cat: "Adventure", desc: "More madness in the classroom." },
            { name: "Learn to Fly", img: "thumbnails/learntofly.png", url: "https://Jeremy4401.github.io/SME/games/learntofly.html", cat: "Arcade", desc: "Help a penguin learn to fly." },
            { name: "Melon Playground", img: "thumbnails/melonplayground.png", url: "https://Jeremy4401.github.io/SME/games/melonplayground.html", cat: "Sandbox", desc: "A fun physics sandbox." },
            { name: "Doodle Jump", img: "thumbnails/doodlejump.png", url: "https://Jeremy4401.github.io/SME/games/doodlejump.html", cat: "Arcade", desc: "Jump your way up endless platforms." },
            { name: "Nazi Zombies Portable", img: "thumbnails/nazizombies.png", url: "https://Jeremy4401.github.io/SME/games/nazizombies.html", cat: "Shooter", desc: "Classic zombie survival." },
            { name: "Papers, Please", img: "thumbnails/papersplease.png", url: "https://Jeremy4401.github.io/SME/games/papersplease.html", cat: "Simulation", desc: "A dystopian document thriller." },
            { name: "Pixel Gun 3D", img: "thumbnails/pixelgun.png", url: "https://Jeremy4401.github.io/SME/games/pixelgun.html", cat: "Shooter", desc: "Pixelated online FPS action." },
            { name: "Plants vs Zombies", img: "thumbnails/plantsvszombies.png", url: "https://Jeremy4401.github.io/SME/games/plantsvszombies.html", cat: "Strategy", desc: "Defend your home with plants." },
            { name: "Plants vs Zombies 2 Gardenless", img: "thumbnails/plantsvszombies2.png", url: "https://Jeremy4401.github.io/SME/games/plantsvszombies2.html", cat: "Strategy", desc: "A classic tower defense game." },
            { name: "Pokemon", img: "thumbnails/pokemon.png", url: "https://Jeremy4401.github.io/SME/games/pokemon.html", cat: "RPG", desc: "Catch 'em all!" },
            { name: "Raft", img: "thumbnails/raft.png", url: "https://Jeremy4401.github.io/SME/games/raft.html", cat: "Survival", desc: "Survive on a raft in the ocean." },
            { name: "Ragdoll Archers", img: "thumbnails/ragdollarchers.png", url: "https://Jeremy4401.github.io/SME/games/ragdollarchers.html", cat: "Action", desc: "Physics-based archery battles." },
            { name: "Two Player Battle", img: "thumbnails/2playerbattle.png", url: "https://turbowarp.org/292728003/embed", cat: "Action", desc: "Fun local 2-player game." },
            { name: "Retro Bowl", img: "thumbnails/retrobowl.png", url: "https://Jeremy4401.github.io/SME/games/retrobowl.html", cat: "Sports", desc: "A retro-style football management game." },
            { name: "Retro Bowl College", img: "thumbnails/retrobowlcollege.png", url: "https://Jeremy4401.github.io/SME/games/retrobowlcollege.html", cat: "Sports", desc: "College football management." },
            { name: "Slither.io", img: "thumbnails/slitherio.png", url: "https://Jeremy4401.github.io/SME/games/slitherio.html", cat: "Multiplayer", desc: "Grow your snake in this classic io game." },
            { name: "Slope", img: "thumbnails/slope.png", url: "https://Jeremy4401.github.io/SME/games/slope.html", cat: "Racing", desc: "Roll down the slope and avoid obstacles." },
            { name: "Smash Karts", img: "thumbnails/smashkarts.png", url: "https://Jeremy4401.github.io/SME/games/smashkarts.html", cat: "Multiplayer", desc: "Multiplayer kart combat." },
            { name: "Snow Rider 3D", img: "thumbnails/snowrider.png", url: "https://Jeremy4401.github.io/SME/games/snowrider.html", cat: "Racing", desc: "Ride your sled down a snowy track." },
            { name: "Steal a Brainrot", img: "thumbnails/stealabrainrot.png", url: "https://Jeremy4401.github.io/SME/games/stealabrainrot.html", cat: "Arcade", desc: "A weird, fast-paced game." },
            { name: "Subway Surfers", img: "thumbnails/subwaysurfers.png", url: "https://Jeremy4401.github.io/SME/games/subwaysurfers.html", cat: "Arcade", desc: "Run and dodge trains." },
            { name: "SUPERHOT", img: "thumbnails/superhot.png", url: "https://Jeremy4401.github.io/SME/games/superhot.html", cat: "Shooter", desc: "Time moves only when you move." },
            { name: "Super Mario 64", img: "thumbnails/supermario64.png", url: "https://Jeremy4401.github.io/SME/games/supermario64.html", cat: "Platformer", desc: "The classic 3D adventure." },
            { name: "Super Mario Bros", img: "thumbnails/supermariobros.png", url: "https://Jeremy4401.github.io/SME/games/supermariobros.html", cat: "Platformer", desc: "The original side-scroller." },
            { name: "Survival Race", img: "thumbnails/survivalrace.png", url: "https://Jeremy4401.github.io/SME/games/survivalrace.html", cat: "Racing", desc: "A race for survival." },
            { name: "Temple Run 2", img: "thumbnails/templerun2.png", url: "https://Jeremy4401.github.io/SME/games/templerun2.html", cat: "Arcade", desc: "Run from the demon monkeys." },
            { name: "They are Coming", img: "thumbnails/theyarecoming.png", url: "https://Jeremy4401.github.io/SME/games/theyarecoming.html", cat: "Shooter", desc: "Shoot the approaching enemies." },
            { name: "Baldi's Basics", img: "thumbnails/baldisbasics.png", url: "https://Jeremy4401.github.io/SME/games/baldisbasics.html", cat: "Horror", desc: "Collect notebooks and escape Baldi." },
            { name: "Tiny Fishing", img: "thumbnails/tinyfishing.png", url: "https://Jeremy4401.github.io/SME/games/tinyfishing.html", cat: "Casual", desc: "Cast your line and catch fish." },
            { name: "Tomb of the Mask", img: "thumbnails/tombofthemask.png", url: "https://Jeremy4401.github.io/SME/games/tombofthemask.html", cat: "Arcade", desc: "Fast-paced maze runner." },
            { name: "Cut the Rope", img: "thumbnails/cuttherope.png", url: "https://Jeremy4401.github.io/SME/games/cuttherope.html", cat: "Puzzle", desc: "Physics-based puzzle fun." },
            { name: "Crossy Road", img: "thumbnails/crossyroad.png", url: "https://Jeremy4401.github.io/SME/games/crossyroad.html", cat: "Arcade", desc: "Cross the road without getting hit." },
            { name: "Cookie Clicker", img: "thumbnails/cookieclicker.png", url: "https://Jeremy4401.github.io/SME/games/cookieclicker.html", cat: "Idle", desc: "The classic incremental game." },
            { name: "Buildnow GG", img: "thumbnails/buildnow.png", url: "https://Jeremy4401.github.io/SME/games/buildnow.html", cat: "Shooter", desc: "Build and fight online." },
            { name: "Bouncemasters", img: "thumbnails/bouncemasters.png", url: "https://Jeremy4401.github.io/SME/games/bouncemasters.html", cat: "Arcade", desc: "Launch a penguin as far as you can." },
            { name: "Bitlife", img: "thumbnails/bitlife.png", url: "https://Jeremy4401.github.io/SME/games/bitlife.html", cat: "Simulation", desc: "Live your life, one text choice at a time." },
            { name: "Bank Robbery 2", img: "thumbnails/bankrobbery2.png", url: "https://jeremy4401.github.io/SME/games/bankrobbery2.html", cat: "Action", desc: "Plan and execute a bank heist." },
            { name: "Basket Random", img: "thumbnails/basketrandom.png", url: "https://jeremy4401.github.io/SME/games/basketrandom.html", cat: "Sports", desc: "Hilarous physics-based basketball." },
            { name: "ULTRAKILL", img: "thumbnails/ultrakill.png", url: "https://jeremy4401.github.io/SME/games/ultrakill.html", cat: "Shooter", desc: "High-octane retro FPS." },
            { name: "Bendy & The Ink Machine", img: "thumbnails/bendy.png", url: "https://jeremy4401.github.io/SME/games/bendy.html", cat: "Horror", desc: "Cartoon horror in an old studio." },
            { name: "Cuphead", img: "thumbnails/cuphead.png", url: "https://jeremy4401.github.io/SME/games/cuphead.html", cat: "Platformer", desc: "A challenging run-and-gun game." },
            { name: "Half Life", img: "thumbnails/halflife.png", url: "https://jeremy4401.github.io/SME/games/halflife.html", cat: "Shooter", desc: "The revolutionary sci-fi FPS." },
            { name: "R.E.P.O.", img: "thumbnails/repo.png", url: "https://jeremy4401.github.io/SME/games/repo.html", cat: "Action", desc: "A retro pixel action game." },
            { name: "Bad Parenting", img: "thumbnails/badparenting.png", url: "https://jeremy4401.github.io/SME/games/badparenting.html", cat: "Horror", desc: "Survive a scary home environment." }
        ];
        
        let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

        function isFavorite(name) {
            return favorites.includes(name);
        }

        function toggleFavorite(name) {
            const index = favorites.indexOf(name);
            if (index > -1) {
                favorites.splice(index, 1);
                notify(`${name} removed from favorites.`, 'info');
            } else {
                favorites.unshift(name);
                notify(`${name} added to favorites!`, 'success');
            }
            localStorage.setItem("favorites", JSON.stringify(favorites));
            
            // Re-render the current view if it's games or favorites
            if (document.getElementById('games').classList.contains('active')) {
                renderGames();
            } else if (document.getElementById('favorites').classList.contains('active')) {
                renderFavorites();
            }
        }

        function renderGameCard(g) {
            const favClass = isFavorite(g.name) ? 'fav' : '';
            return `
                <div class="card" onclick="showGameModal('${g.name}')">
                    <span class="star ${favClass}" onclick="event.stopPropagation(); toggleFavorite('${g.name}')">‚≠ê</span>
                    <img src="${g.img}" alt="${g.name}">
                    <div style="text-align:center;">
                        <strong>${g.name}</strong><br>
                        <span style="font-size: 12px; opacity: 0.7;">${g.cat}</span>
                    </div>
                </div>
            `;
        }

        function renderGames() {
            const sec = document.getElementById("games");
            const box = document.getElementById("gameList");
            if (!sec || !box) return;

            // Simple rendering without search/sort (as those inputs were not in the HTML)
            box.innerHTML = games.map(renderGameCard).join('');
        }

        function renderFavorites() {
            const box = document.getElementById("favoriteList");
            if (!box) return;

            const favoriteGames = games.filter(g => isFavorite(g.name));

            if (favoriteGames.length === 0) {
                box.innerHTML = "<p>You haven't added any favorites yet.</p>";
                return;
            }

            box.innerHTML = favoriteGames.map(renderGameCard).join('');
        }

        /* ============================
            GAME MODAL & LAUNCH
        ============================ */

        let activeGame = null;

        function showGameModal(gameName) {
            const game = games.find(g => g.name === gameName);
            if (!game) return;

            activeGame = game;
            
            document.getElementById('modalTitle').textContent = game.name;
            document.getElementById('modalDesc').textContent = game.desc || "No description available.";
            document.getElementById('modalImg').src = game.img;

            // Check if game is in recent list to show play time (placeholder)
            const isRecent = recent.includes(game.name);
            document.getElementById('playtimeBox').innerHTML = isRecent ? 
                '<p style="color:var(--accent);">You recently played this!</p>' : '';
            
            document.getElementById('playBtn').onclick = () => launchGame(game.name);

            document.getElementById('gameModal').style.display = 'flex';
        }
        
        function closeGameModal() {
            document.getElementById('gameModal').style.display = 'none';
            activeGame = null;
        }

        function launchGame(gameName) {
            const game = games.find(g => g.name === gameName);
            if (!game) return;

            closeGameModal(); // Close the modal
            
            const embedWin = document.getElementById('embedWin');
            const embedFrame = document.getElementById('embedFrame');

            embedFrame.src = enc(game.url);
            embedWin.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Hide main scrollbar

            addRecent(game.name);
            addActivity('Played Game', `Started playing ${game.name}`);
        }

        function closeEmbed() {
            const embedWin = document.getElementById('embedWin');
            const embedFrame = document.getElementById('embedFrame');
            
            embedFrame.src = ''; // Clear the iframe content
            embedWin.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore main scrollbar

            if (activeGame) {
                addActivity('Finished Game', `Finished playing ${activeGame.name}`);
                activeGame = null;
            }
            renderHome(); // Update the Continue Playing list
        }

        // Global key listener to escape the game embed
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('embedWin').style.display === 'block') {
                closeEmbed();
            }
        });

        /* ============================
                    PROFILE
        ============================ */

        function renderProfile() {
            document.getElementById('profileUsername').textContent = profile.username;
            document.getElementById('profileBio').textContent = profile.bio;
            document.getElementById('profileStatus').textContent = profile.status;
            document.getElementById('profileCode').textContent = friendCode;
            document.getElementById('profileAvatarImg').src = profile.avatar;
        }

        /* ============================
                    SETTINGS
        ============================ */

        function openSettings() {
            nav('settingsPage');
            const content = document.getElementById('settingsContent');
            content.innerHTML = `
                <h3>Profile Settings</h3>
                <label for="setUsername">Username:</label><br>
                <input type="text" id="setUsername" value="${profile.username}" style="padding:8px; width:90%; margin-bottom:10px; border-radius:4px; border:1px solid #555; background: var(--bg); color: var(--text);"><br>
                
                <label for="setBio">Bio:</label><br>
                <textarea id="setBio" style="padding:8px; width:90%; height: 80px; margin-bottom:10px; border-radius:4px; border:1px solid #555; background: var(--bg); color: var(--text);">${profile.bio}</textarea><br>
                
                <label for="setAvatar">Avatar URL:</label><br>
                <input type="url" id="setAvatar" value="${profile.avatar}" style="padding:8px; width:90%; margin-bottom:10px; border-radius:4px; border:1px solid #555; background: var(--bg); color: var(--text);"><br>
                
                <label for="setStatus">Status:</label><br>
                <select id="setStatus" style="padding:8px; width:94%; margin-bottom:15px; border-radius:4px; background: var(--bg); color: var(--text);">
                    <option value="Online">Online</option>
                    <option value="Away">Away</option>
                    <option value="Busy">Busy</option>
                </select><br>

                <button onclick="saveProfile()" style="padding:10px; border:none; border-radius:8px; background:var(--accent); color:white; cursor:pointer;">Save Profile</button>
            `;
            document.getElementById('setStatus').value = profile.status;
        }

        function saveProfile() {
            const username = document.getElementById('setUsername').value.trim();
            const bio = document.getElementById('setBio').value.trim();
            const avatar = document.getElementById('setAvatar').value.trim();
            const status = document.getElementById('setStatus').value;

            profile.username = username || "SME User";
            profile.bio = bio;
            profile.avatar = avatar || "https://i.imgur.com/1X5Rz.png";
            profile.status = status;

            localStorage.setItem("profile", JSON.stringify(profile));
            notify("Profile saved successfully!", "success");
            renderProfile();
            renderHome();
        }

        // Initial setup calls
        document.addEventListener('DOMContentLoaded', () => {
            // Apply light theme if it was previously set (simple example)
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light');
            }
            renderHome(); // Ensure home content is rendered on load
            renderGames(); // Pre-render games list for the game section
        });
    </script>
</body>
</html>
