
<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='UTF-8'>
<title>SME Platform - FULL SYSTEM</title>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>

<style>
/* GLOBAL THEME */
@font-face { font-family: "Comic Sans MS"; src: local("Comic Sans MS"); }
:root {
  --bg:#0f0f0f; --bg2:#1a1a1a; --text:#fff; --accent:#4caf50;
  --sidebar:#000; --banner1:#000; --banner2:#0f0f0f;
}
body {
  margin:0; background:var(--bg); color:var(--text);
  font-family:"Comic Sans MS"; overflow-x:hidden;
}

/* ANIMATED BACKGROUND */
body::before {
  content:""; position:fixed; inset:0; z-index:-1;
  background:linear-gradient(130deg,#000,#0c0c0c,#111);
  background-size:240% 240%;
  animation:bgwave 14s infinite ease;
}
@keyframes bgwave {
  0%{background-position:0% 50%;}
 50%{background-position:100% 50%;}
100%{background-position:0% 50%;}
}

/* SIDEBAR */
#sidebar {
  position:fixed; top:0; left:0; width:75px; height:100%;
  background:var(--sidebar); padding-top:20px;
  display:flex; flex-direction:column; gap:10px;
}
#sidebar div {
  padding:15px; cursor:pointer; text-align:center; font-size:24px;
  transition:.2s;
}
#sidebar div:hover { transform:scale(1.2); }

/* MAIN AREA */
#main { margin-left:90px; padding:20px; }

/* SECTION */
.section { display:none; }
.section.active { display:block; }

/* BANNER PROFILE HEADER (Style B - Soft Black Gradient) */
.profileBanner {
  background:linear-gradient(to bottom, var(--banner1), var(--banner2));
  height:160px; border-radius:12px; margin-bottom:20px;
  position:relative;
}
.profileAvatar {
  width:110px; height:110px; border-radius:50%;
  position:absolute; bottom:-40px; left:20px;
  border:4px solid var(--accent); object-fit:cover;
}

/* GENERIC CARDS */
.card {
  background:var(--bg2); width:180px; border-radius:12px;
  padding:12px; display:inline-block; margin:8px;
  cursor:pointer; transition:.2s;
}
.card:hover { transform:translateY(-6px) scale(1.05); }
.card img { width:100%; border-radius:10px; }

/* FAVORITE STAR */
.star {
  position:absolute; top:8px; left:8px;
  font-size:20px; cursor:pointer; color:#777;
}
.star.fav { color:gold; text-shadow:0 0 10px gold; }

/* EMBED */
#embedWin {
  display:none; position:fixed; inset:0; background:#000d; z-index:9999;
}
#embedWin iframe { width:100%; height:100%; border:none; }
</style>
</head>
<body>

<div id='sidebar'>
  <div onclick="nav('games')">üéÆ</div>
  <div onclick="nav('downloads')">‚¨á</div>
  <div onclick="nav('favorites')">‚≠ê</div>
  <div onclick="nav('friends')">üë•</div>
  <div onclick="nav('profile')">üë§</div>
  <div onclick="toggleTheme()">üåó</div>
  <div onclick="panic()">‚ö†</div>
</div>

<div id='main'>

<h1 id='pageTitle'>SME Platform</h1>

<!-- Sections will be filled in later steps -->

<div id='games' class='section active'></div>
<div id='downloads' class='section'></div>
<div id='favorites' class='section'></div>
<div id='friends' class='section'></div>
<div id='profile' class='section'></div>

</div>

<div id='embedWin'><iframe id='embedFrame'></iframe></div>

<script>
function nav(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.getElementById('pageTitle').textContent = id.charAt(0).toUpperCase()+id.slice(1);
}
function toggleTheme(){ document.body.classList.toggle('light'); }
function panic(){ location.href="https://classroom.google.com"; }

const uv="https://holyubofficial.net/service/";
function enc(u){ return uv + btoa(u).replace(/=/g,""); }

let favorites = JSON.parse(localStorage.getItem('favorites')||"[]");
let profile = JSON.parse(localStorage.getItem('profile')||"{}");
let friends = JSON.parse(localStorage.getItem('friends')||"[]");
let requests = JSON.parse(localStorage.getItem('requests')||"[]");
let friendCode = "USER" + Math.floor(Math.random()*99999);


/* ===========================
   STEP 2 - GAME SYSTEM
========================== */

let games = [
  {name:"Slime Rancher", img:"thumb1.png", url:"https://jeremy4401.github.io/slime-rancher/", cat:"Action"},
  {name:"Minecraft Classic", img:"thumb2.png", url:"https://classic.minecraft.net/", cat:"Survival"},
  {name:"Buckshot Roulette", img:"thumb3.png", url:"https://cdn.jsdelivr.net/gh/genizy/web-port@main/buckshot-roulette/index.html", cat:"Horror"}
];

/* Load Games */
function renderGames(){
  let html = "<h1>Games</h1>";
  games.forEach(g=>{
    let fav = favorites.includes(g.name) ? "fav" : "";
    html += `
    <div class='card' onclick="play(enc('${g.url}'))" style="position:relative;">
      <div class="star ${fav}" onclick="toggleFav('${g.name}'); event.stopPropagation();">‚òÖ</div>
      <img src="${g.img}">
      <button>${g.name}</button>
    </div>`;
  });
  document.getElementById('games').innerHTML = html;
}

/* Favorites */
function toggleFav(name){
  if(favorites.includes(name)) favorites = favorites.filter(f=>f!==name);
  else favorites.push(name);
  localStorage.setItem('favorites', JSON.stringify(favorites));
  renderGames(); renderFavs();
}

function renderFavs(){
  let html = "<h1>Favorites</h1>";
  favorites.forEach(f=>{
    let g = games.find(x=>x.name===f);
    if(g){
      html += `
      <div class='card' onclick="play(enc('${g.url}'))">
        <img src="${g.img}">
        <button>${g.name}</button>
      </div>`;
    }
  });
  document.getElementById('favorites').innerHTML = html;
}

/* Game Embed */
function play(url){
  document.getElementById('embedWin').style.display='block';
  document.getElementById('embedFrame').src = url;
}
document.addEventListener('keydown', e=>{
  if(e.key==="Escape"){
    document.getElementById('embedWin').style.display='none';
    document.getElementById('embedFrame').src="";
  }
});

/* Initialize Step 2 */
renderGames();
renderFavs();


/* ===========================
   STEP 3 - FRIEND SYSTEM
=========================== */

/* Render Friends Section */
function renderFriends(){
  let html = `
    <h1>Friends</h1>
    <h3>Your Friend Code:</h3>
    <div style='background:#222;padding:10px;border-radius:8px;margin-bottom:15px;'>
      ${friendCode}
    </div>

    <h3>Friend Requests</h3>
    <div id='reqList'></div>

    <h3>Your Friends</h3>
    <div id='friendList'></div>

    <h3>Add Friend</h3>
    <input id='addFriendCode' placeholder='Enter friend code' style='padding:8px;border-radius:8px;border:none;background:#222;color:white;'>
    <button onclick='sendFriendRequest()' style='padding:8px;border:none;border-radius:6px;background:#4caf50;color:white;margin-left:6px;'>Add</button>

    <h3>Friend Profile</h3>
    <div id='friendProfile' style='display:none;'></div>
  `;
  document.getElementById('friends').innerHTML = html;
  loadRequests();
  loadFriends();
}
renderFriends();

/* Send Friend Request */
function sendFriendRequest(){
  let code = document.getElementById('addFriendCode').value.trim();
  if(!code) return alert("Enter a code.");
  if(code === friendCode) return alert("You cannot add yourself.");

  requests.push({from:code});
  saveSocial();
  loadRequests();
  alert("Friend request sent!");
}

/* Load Friend Requests */
function loadRequests(){
  let html = "";
  requests.forEach(r=>{
    html += `
      <div class='reqCard'>
        Request from ${r.from}<br>
        <button onclick="acceptReq('${r.from}')">Accept</button>
        <button onclick="declineReq('${r.from}')">Decline</button>
      </div>`;
  });
  document.getElementById('reqList').innerHTML = html;
}

/* Accept / Decline */
function acceptReq(code){
  if(!friends.includes(code)) friends.push(code);
  requests = requests.filter(r=>r.from !== code);
  saveSocial();
  loadRequests();
  loadFriends();
}
function declineReq(code){
  requests = requests.filter(r=>r.from !== code);
  saveSocial();
  loadRequests();
}

/* Load Friends */
function loadFriends(){
  let html = "";
  friends.forEach(code=>{
    html += `
      <div class='friendCard' onclick="openFriend('${code}')">
        <b>${code}</b><br>Status: Online
      </div>`;
  });
  document.getElementById('friendList').innerHTML = html;
}

/* Friend Profile (Style B) */
function openFriend(code){
  document.getElementById('friendProfile').style.display = 'block';
  document.getElementById('friendProfile').innerHTML = `
    <div class='profileBanner'></div>
    <img class='profileAvatar' src='https://i.imgur.com/1X5Rz.png'>
    <div style='margin-left:150px;margin-top:10px;'>
      <h2>${code}</h2>
      <p>Status: Online</p>
      <p>Friend since: Today</p>
      <button onclick="removeFriend('${code}')" style='padding:8px;border:none;border-radius:6px;background:#c0392b;color:white;'>Remove Friend</button>
    </div>
  `;
}

/* Remove friend */
function removeFriend(code){
  friends = friends.filter(f=>f!==code);
  saveSocial();
  loadFriends();
  document.getElementById('friendProfile').style.display='none';
}

/* Save social data */
function saveSocial(){
  localStorage.setItem('friends',JSON.stringify(friends));
  localStorage.setItem('requests',JSON.stringify(requests));
}


/* ===========================
   STEP 4 - PROFILE SYSTEM
=========================== */

function renderProfile(){
  let html = `
    <h1>Your Profile</h1>
    <div class='profileBanner'></div>
    <img class='profileAvatar' id='userAvatar' src='${profile.avatar || "https://i.imgur.com/1X5Rz.png"}'>
    <div style='margin-left:150px;margin-top:10px;'>
      <h2 id='usernameDisplay'>${profile.username || "Player"}</h2>
      <p>Status: <span id='statusDisplay'>${profile.status || "Online"}</span></p>
      <p>Bio: ${profile.bio || "No bio set."}</p>

      <h3>Edit Profile</h3>
      <input id='usernameInput' placeholder='Username' value='${profile.username || ""}'><br><br>
      <textarea id='bioInput' placeholder='Bio...'>${profile.bio || ""}</textarea><br><br>
      <select id='statusInput'>
        <option ${profile.status==="Online"?"selected":""}>Online</option>
        <option ${profile.status==="Busy"?"selected":""}>Busy</option>
        <option ${profile.status==="Offline"?"selected":""}>Offline</option>
      </select><br><br>
      <input id='avatarInput' placeholder='Avatar image URL' value='${profile.avatar || ""}'><br><br>

      <button onclick='saveProfileFull()' style='padding:10px;border:none;background:#4caf50;color:white;border-radius:6px;'>Save</button>
    </div>
  `;
  document.getElementById('profile').innerHTML = html;
}
renderProfile();

function saveProfileFull(){
  profile.username = document.getElementById('usernameInput').value;
  profile.bio = document.getElementById('bioInput').value;
  profile.status = document.getElementById('statusInput').value;
  profile.avatar = document.getElementById('avatarInput').value;

  localStorage.setItem('profile', JSON.stringify(profile));
  renderProfile();
  alert("Profile updated!");
}


/* ===========================
   STEP 5 - FINAL POLISH SYSTEMS
=========================== */

/* Recently Played */
let recent = JSON.parse(localStorage.getItem('recent')||"[]");
function addRecent(name){
  recent = recent.filter(r=>r!==name);
  recent.unshift(name);
  if(recent.length>10) recent.pop();
  localStorage.setItem('recent',JSON.stringify(recent));
}
function renderRecent(){
  let html = "<h1>Recently Played</h1>";
  recent.forEach(r=>{
    let g = games.find(x=>x.name===r);
    if(g){
      html += `
      <div class='card' onclick="play(enc('${g.url}')); addRecent('${r}')">
        <img src="${g.img}">
        <button>${g.name}</button>
      </div>`;
    }
  });
  let sec = document.createElement("div");
  sec.innerHTML = html;
  document.getElementById("games").prepend(sec);
}

/* Override play function to track recents */
const oldPlay = play;
play = function(url){
  let g = games.find(x=>enc(x.url)===url);
  if(g) addRecent(g.name);
  oldPlay(url);
};

/* Categories */
function renderCategories(){
  let cats = [...new Set(games.map(g=>g.cat))];
  let html = "<h3>Categories:</h3>";
  cats.forEach(c=>{
    html += `<button onclick="filterCat('${c}')" style='margin:5px;padding:6px;border-radius:6px;background:#333;color:white;border:none;'>${c}</button>`;
  });
  html += `<button onclick="renderGames(); renderRecent()" style='margin:5px;padding:6px;border-radius:6px;background:#4caf50;color:white;border:none;'>All</button>`;
  document.getElementById('games').innerHTML = html + document.getElementById('games').innerHTML;
}
function filterCat(c){
  let html = "<h1>Games</h1>";
  games.filter(g=>g.cat===c).forEach(g=>{
    let fav = favorites.includes(g.name) ? "fav" : "";
    html += `
    <div class='card' onclick="play(enc('${g.url}')); addRecent('${g.name}')" style="position:relative;">
      <div class="star ${fav}" onclick="toggleFav('${g.name}'); event.stopPropagation();">‚òÖ</div>
      <img src="${g.img}">
      <button>${g.name}</button>
    </div>`;
  });
  document.getElementById('games').innerHTML = html;
}

/* Activity Feed (basic placeholder) */
function renderActivity(){
  let html = "<h1>Activity Feed</h1><p>(Activity tracking placeholder)</p>";
  let sec = document.createElement("div");
  sec.innerHTML=html;
  document.getElementById('friends').append(sec);
}

/* Initialize Step 5 */
renderRecent();
renderCategories();
renderActivity();

</script>

</body>
</html>
